<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.png') }}">
</head>
<body>
    <div id="app">
        <div id="controls">
            <!-- Header section -->
            <div class="header">
                <h1>üó∫Ô∏è Navigation App</h1>
                <p>Plan your route with live tracking</p>
            </div>

            <div class="location-input">
                <label for="start-input"> <img src="{{ url_for('static', filename='images/start.svg') }}" alt="Start Icon">
                     Start Location</label>
                <div class="input-group">
                    <input type="text" id="start-input" placeholder="Enter start location...">
                    <button id="start-current-btn" class="btn btn-secondary">Use Current</button>
                </div>
                <div class="suggestions" id="start-suggestions"></div>
            </div>
            <div class="location-input">
                <label for="end-input"><img src="{{ url_for('static', filename='images/target.svg') }}" alt="Start Icon"> End Location</label>
                <div class="input-group">
                    <input type="text" id="end-input" placeholder="Enter end location...">
                    <button id="end-current-btn" class="btn btn-secondary">Use Current</button>
                </div>
                <div class="suggestions" id="end-suggestions"></div>
            </div>

            <div class="map-click-buttons">
                <button class="map-click-btn" id="set-start-map">
                    <img src="{{ url_for('static', filename='images/pin.svg') }}" id="Before-text" alt="Start Icon">
                    <label id="after-img">Set Start on Map</label>
                </button>
                <button class="map-click-btn" id="set-end-map">
                    <img src="{{ url_for('static', filename='images/pin.svg') }}" id="Before-text" alt="End Icon">
                    <label id="after-img">Set End on Map</label>
                </button>
            </div>

            <div id="poi-buttons">
                <button class="poi-btn" data-type="hospital"><img src="{{ url_for('static', filename='images/hospital.svg') }}" alt="Hospital Icon"> Hospital</button>
                <button class="poi-btn" data-type="atm"><img src="{{ url_for('static', filename='images/atm.svg') }}" alt="ATM Icon"> ATM</button>
                <button class="poi-btn" data-type="fuel"><img src="{{ url_for('static', filename='images/petrol.svg') }}" alt="Petrol Icon"> Petrol Pump</button>
            </div>

            <div class="controls-row">
                <select id="mode-select">
                    <option value="driving">üöó Car</option>
                    <option value="cycling">üèçÔ∏è Two-Wheeler</option>
                </select>
                <button id="calc-btn" class="btn btn-primary">Calculate Route</button>
            </div>

            <button id="theme-toggle" title="Toggle Light/Dark Mode" data-sun="{{ url_for('static', filename='images/sun.svg') }}" data-moon="{{ url_for('static', filename='images/moon.svg') }}">
                <img src="{{ url_for('static', filename='images/moon.svg') }}" alt="Theme Toggle Icon">
            </button>

            <div id="route-info">
                <div id="route-info-distance"> <img src="{{ url_for('static', filename='images/ruler.svg') }}" alt="Measurement Icon">
                    &nbsp;&nbsp;Distance:&nbsp;
                    <span id="route-distance-value">--</span>
                </div>
                <div id="route-info-time"> <img src="{{ url_for('static', filename='images/alarm.svg') }}" alt="Time Icon">
                    &nbsp;Time: &nbsp;
                    <span id="route-time-value">--</span>
                </div>
            </div>
        </div>
        <div id="map">
            
        </div>
        </div>
    </div>

    <div id="status">Getting your location...</div>

    <dialog id="add-location-dialog">
        <form method="dialog" id="add-location-form">
            <h3>Add Location</h3>

            <label for="location-type">Location Type:</label>
            <select id="location-type">
            <option value="current">Current</option>
            <option value="start">Start</option>
            <option value="end">End</option>
            </select>

            <label for="location-name">Name:</label>
            <input type="text" id="location-name" required>

            <div style="margin-top: 1em; display: flex; justify-content: flex-end; gap: 0.5em;">
            <button type="button" id="cancel-dialog">Cancel</button>
            <button type="button" id="save-location">Save</button>
            </div>
        </form>
    </dialog>

    <dialog id="set-location-dialog">
        <p id="selected-location-name" style="font-weight: 500;"></p>
        <div style="display: flex; justify-content: space-between; margin-top: 1em;">
            <button type="button" id="set-start">Set as Start</button>
            <button type="button" id="set-end">Set as End</button>
            <button type="button" id="delete-location" style="background: #dc262683;">Delete</button>
        </div>
    </dialog>

    <div id="bottom-bar">
        {% if g.user %}
            <button id="sign-in-button" onclick="location.href = '{{ url_for('auth.logout')}} '">Sign Out</button>
            <button id="add-location-button">Save Current Location</button>
        {% else %}
            <button id="sign-in-button" onclick='location.href = "{{url_for('auth.login')}}"'>Sign in</button>
        {% endif %}

        <div id="locations">
            {% for location in locations %}
                <div class="location-display" data-id="{{ location['id'] }}">
                <div class="location-name">{{ location["name"] }}</div>
                <div class="location-pos-x" hidden>{{ location["location_x"] }}</div>
                <div class="location-pos-y" hidden>{{ location["location_y"] }}</div>
                </div>
            {% endfor %}
        </div>

        {% if g.user %}
            <div id="bottom-bar-text">
                Saved Locations: 
            </div>
        {% endif %}
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="{{ url_for('static', filename='map-script.js') }}"></script>

    <script>
    </script>
</body>
</html>